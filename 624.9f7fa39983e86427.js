(self.webpackChunkapp=self.webpackChunkapp||[]).push([[624],{6553:(F,M,k)=>{"use strict";k.d(M,{d:()=>B});var C=k(8735);class B{static parse(i){if(!i)return null;let v=new B;return v.id=i.id,v.name=i.name,v.releaseDate=new Date(i.releaseDate),v.artistId=i.artistId,v.artistName=i.artistName,v.externalUrl=i.externalUrl,v.href=i.href,v.uri=i.uri,v.excluded=i.excluded,v.images=i.images.map(U=>C.Q.parse(U)).sort((U,T)=>T.width-U.width),v}static parseWebPlaybackAlbum(i){let v=new B;return i&&(v.externalUrl=i.external_urls.spotify,v.href=i.href,v.id=i.id,v.images=i.images.map(U=>C.Q.parse(U)).sort((U,T)=>T.width-U.width),v.name=i.name,v.releaseDate=new Date(i.release_date),v.uri=i.uri),v}}},7986:(F,M,k)=>{"use strict";k.d(M,{l:()=>B});var C=k(8735);class B{static parse(i){if(!i)return null;let v=new B;return v.externalUrl=i.externalUrl,v.genres=i.genres,v.href=i.href,v.id=i.id,v.images=i.images.map(U=>C.Q.parse(U)).sort((U,T)=>T.width-U.width),v.name=i.name,v.uri=i.uri,v}static parseWebPlaybackArtist(i){if(!i)return null;let v=new B;return v.externalUrl=i.external_urls.spotify,v.genres=i.genres,v.href=i.href,v.id=i.id,i.images&&(v.images=i.images.map(U=>C.Q.parse(U)).sort((U,T)=>T.width-U.width)),v.name=i.name,v.uri=i.uri,v}}},8735:(F,M,k)=>{"use strict";k.d(M,{Q:()=>C});class C{static parse(g){if(!g)return null;let i=new C;return i.height=g.height,i.width=g.width,i.url=g.url,i}}},4733:(F,M,k)=>{"use strict";k.d(M,{t:()=>C});class C{static parse(g){if(!g)return null;let i=new C;return i.id=g.id,i.name=g.name,i.trackNumber=g.trackNumber,i.discNumber=g.discNumber,i.albumId=g.albumId,i.albumName=g.albumName,i.albumReleaseDate=g.albumReleaseDate,i.artistId=g.artistId,i.artistName=g.artistName,i.image=g.image,i.externalURL=g.externalURL,i.href=g.href,i.uri=g.uri,i}static parsePlayerTrack(g){let i=new C;return g&&(i.artistName=g.artists[0],i.id=g.id,i.image=g.image,i.name=g.name,i.uri=g.uri),i}static parseWebPlaybackTrack(g){let i=new C;return g&&(i.albumId=g.album.id,i.albumName=g.album.name,i.albumReleaseDate=new Date(g.album.release_date),i.artistId=g.artists[0].id,i.artistName=g.artists[0].name,i.discNumber=g.disc_number,i.externalURL=g.external_urls.spotify,i.href=g.href,i.id=g.id,i.image=g.album.images.sort((v,U)=>U.width-v.width)[0].url,i.name=g.name,i.uri=g.uri,i.trackNumber=g.track_number),i}}},624:(F,M,k)=>{"use strict";k.d(M,{$:()=>Z});var C=k(5861),B=k(6553),g=k(7986);class i{}var w,v=k(8735),U=k(4733),T=k(6738),E=k(3191),A=k(8799),S=k.n(A),b=k(8319),N=k.n(b);!function z(){var P;w=w||function(x,P){var a={},t=a.lib={},h=function(){},c=t.Base={extend:function(r){h.prototype=this;var u=new h;return r&&u.mixIn(r),u.hasOwnProperty("init")||(u.init=function(){u.$super.init.apply(this,arguments)}),u.init.prototype=u,u.$super=this,u},create:function(){var r=this.extend();return r.init.apply(r,arguments),r},init:function(){},mixIn:function(r){for(var u in r)r.hasOwnProperty(u)&&(this[u]=r[u]);r.hasOwnProperty("toString")&&(this.toString=r.toString)},clone:function(){return this.init.prototype.extend(this)}},s=t.WordArray=c.extend({init:function(r,u){r=this.words=r||[],this.sigBytes=null!=u?u:4*r.length},toString:function(r){return(r||n).stringify(this)},concat:function(r){var u=this.words,y=r.words,_=this.sigBytes;if(r=r.sigBytes,this.clamp(),_%4)for(var R=0;R<r;R++)u[_+R>>>2]|=(y[R>>>2]>>>24-R%4*8&255)<<24-(_+R)%4*8;else if(65535<y.length)for(R=0;R<r;R+=4)u[_+R>>>2]=y[R>>>2];else u.push.apply(u,y);return this.sigBytes+=r,this},clamp:function(){var r=this.words,u=this.sigBytes;r[u>>>2]&=4294967295<<32-u%4*8,r.length=x.ceil(u/4)},clone:function(){var r=c.clone.call(this);return r.words=this.words.slice(0),r},random:function(r){for(var u=[],y=0;y<r;y+=4)u.push(4294967296*x.random()|0);return new s.init(u,r)}}),e=a.enc={},n=e.Hex={stringify:function(r){var u=r.words;r=r.sigBytes;for(var y=[],_=0;_<r;_++){var R=u[_>>>2]>>>24-_%4*8&255;y.push((R>>>4).toString(16)),y.push((15&R).toString(16))}return y.join("")},parse:function(r){for(var u=r.length,y=[],_=0;_<u;_+=2)y[_>>>3]|=parseInt(r.substr(_,2),16)<<24-_%8*4;return new s.init(y,u/2)}},l=e.Latin1={stringify:function(r){var u=r.words;r=r.sigBytes;for(var y=[],_=0;_<r;_++)y.push(String.fromCharCode(u[_>>>2]>>>24-_%4*8&255));return y.join("")},parse:function(r){for(var u=r.length,y=[],_=0;_<u;_++)y[_>>>2]|=(255&r.charCodeAt(_))<<24-_%4*8;return new s.init(y,u)}},d=e.Utf8={stringify:function(r){try{return decodeURIComponent(escape(l.stringify(r)))}catch{throw Error("Malformed UTF-8 data")}},parse:function(r){return l.parse(unescape(encodeURIComponent(r)))}},f=t.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(r){"string"==typeof r&&(r=d.parse(r)),this._data.concat(r),this._nDataBytes+=r.sigBytes},_process:function(r){var u=this._data,y=u.words,_=u.sigBytes,R=this.blockSize,V=_/(4*R);if(V=r?x.ceil(V):x.max((0|V)-this._minBufferSize,0),_=x.min(4*(r=V*R),_),r){for(var O=0;O<r;O+=R)this._doProcessBlock(y,O);O=y.splice(0,r),u.sigBytes-=_}return new s.init(O,_)},clone:function(){var r=c.clone.call(this);return r._data=this._data.clone(),r},_minBufferSize:0});t.Hasher=f.extend({cfg:c.extend(),init:function(r){this.cfg=this.cfg.extend(r),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(r){return this._append(r),this._process(),this},finalize:function(r){return r&&this._append(r),this._doFinalize()},blockSize:16,_createHelper:function(r){return function(u,y){return new r.init(y).finalize(u)}},_createHmacHelper:function(r){return function(u,y){return new p.HMAC.init(r,y).finalize(u)}}});var p=a.algo={};return a}(Math),P=w.enc.Utf8,w.algo.HMAC=w.lib.Base.extend({init:function(a,t){a=this._hasher=new a.init,"string"==typeof t&&(t=P.parse(t));var h=a.blockSize,c=4*h;t.sigBytes>c&&(t=a.finalize(t)),t.clamp();for(var s=this._oKey=t.clone(),e=this._iKey=t.clone(),n=s.words,l=e.words,d=0;d<h;d++)n[d]^=1549556828,l[d]^=909522486;s.sigBytes=e.sigBytes=c,this.reset()},reset:function(){var a=this._hasher;a.reset(),a.update(this._iKey)},update:function(a){return this._hasher.update(a),this},finalize:function(a){var t=this._hasher;return a=t.finalize(a),t.reset(),t.finalize(this._oKey.clone().concat(a))}}),function(){var P=w.lib.WordArray;w.enc.Base64={stringify:function(a){var t=a.words,h=a.sigBytes,c=this._map;a.clamp(),a=[];for(var s=0;s<h;s+=3)for(var e=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,n=0;4>n&&s+.75*n<h;n++)a.push(c.charAt(e>>>6*(3-n)&63));if(t=c.charAt(64))for(;a.length%4;)a.push(t);return a.join("")},parse:function(a){var t=a.length,h=this._map;(c=h.charAt(64))&&-1!=(c=a.indexOf(c))&&(t=c);for(var c=[],s=0,e=0;e<t;e++)if(e%4){var n=h.indexOf(a.charAt(e-1))<<e%4*2,l=h.indexOf(a.charAt(e))>>>6-e%4*2;c[s>>>2]|=(n|l)<<24-s%4*8,s++}return P.create(c,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(){var x=w,P=(h=x.lib).WordArray,a=h.Hasher,t=[],h=x.algo.SHA1=a.extend({_doReset:function(){this._hash=new P.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(c,s){for(var e=this._hash.words,n=e[0],l=e[1],d=e[2],f=e[3],p=e[4],r=0;80>r;r++){if(16>r)t[r]=0|c[s+r];else{var u=t[r-3]^t[r-8]^t[r-14]^t[r-16];t[r]=u<<1|u>>>31}u=(n<<5|n>>>27)+p+t[r],u=20>r?u+(1518500249+(l&d|~l&f)):40>r?u+(1859775393+(l^d^f)):60>r?u+((l&d|l&f|d&f)-1894007588):u+((l^d^f)-899497514),p=f,f=d,d=l<<30|l>>>2,l=n,n=u}e[0]=e[0]+n|0,e[1]=e[1]+l|0,e[2]=e[2]+d|0,e[3]=e[3]+f|0,e[4]=e[4]+p|0},_doFinalize:function(){var c=this._data,s=c.words,e=8*this._nDataBytes,n=8*c.sigBytes;return s[n>>>5]|=128<<24-n%32,s[14+(n+64>>>9<<4)]=Math.floor(e/4294967296),s[15+(n+64>>>9<<4)]=e,c.sigBytes=4*s.length,this._process(),this._hash},clone:function(){var c=a.clone.call(this);return c._hash=this._hash.clone(),c}});x.SHA1=a._createHelper(h),x.HmacSHA1=a._createHmacHelper(h)}()}();class D{constructor(P,a,t,h,c){var s=this;this.consumer_key=P,this.consumer_secret=a,this.token=t,this.token_secret=h,this._version=c,this._base_url="http://api.music-story.com",this.resp=null,this._checker=function(e,n){var l=setInterval(function(){e()&&(clearInterval(l),n())},10)},this._rawurlencode_rfc3986=function(e){return encodeURIComponent(e).replace("+"," ").replace("%7E","~")},this._load=function(e,n,l){var d=document.createElement("script"),f=document.getElementsByTagName("head")[0];d.type="text/javascript";var p="";for(const r in n.data)p?p+="&":p="?",p+=r+"="+encodeURIComponent(n.data[r]);d.src=e+=p,d.onload=function(){s.resp=json,f.removeChild(d),typeof l<"u"&&l()},f.appendChild(d)},this.get=function(e,n,l,d){if(typeof l>"u"&&(l=null),n){e=e.toLowerCase();var f="getObject";s._request(e,n,null,null,f,null,null,function(){s.constructResult(e,f,d)})}},this.search=function(e,n,l,d,f){e=e.toLowerCase();var p="searchObject";!n||s._request(e,null,null,n,p,d,f,function(){s.constructResult(e,p,l)})},this._sign=function(e,n){var r,u,y,l="",d="",f="";if(e){for(r in n||(n={}),u=new Array,n)u.push(r);for(u.sort(),y=0;y<u.length;y++)l&&(l+="&"),l+=(r=s._rawurlencode_rfc3986(u[y]))+"="+s._rawurlencode_rfc3986(n[u[y]]);return d="GET&"+s._rawurlencode_rfc3986(e.toLowerCase())+"&"+s._rawurlencode_rfc3986(l),f=s._rawurlencode_rfc3986(s.consumer_secret)+"&"+s._rawurlencode_rfc3986(s.token_secret),w.HmacSHA1(d,f).toString(w.enc.Base64)}},this._request=function(e,n,l,d,f,p,r,u){!e&&"getConnector"!==f||"searchObject"===f&&!d||!f||(s.token&&s.token_secret?s._requestsuite(e,n,l,d,f,p,r,u):s.getToken(function(){s._requestsuite(e,n,l,d,f,p,r,u)}))},this._requestsuite=function(e,n,l,d,f,p,r,u){var y,_,R,V;for(R in y=s._base_url+"/"+e,n&&(y+="/"+n),"searchObject"===f&&(y+="/search"),"getConnector"===f&&(y=y+"/"+l),y+=".json",_={oauth_token:s.token,_callback:"var json="},p&&(d.page||(d.page=p)),r&&(d.pageCount||(d.pageCount=r)),d)_[R]=d[R];for(R in V=s._sign(y,_),y+="?oauth_signature="+encodeURIComponent(V),_)y+="&"+encodeURIComponent(R)+"="+encodeURIComponent(_[R]);s._load(y,{},u)},this.getToken=function(e){var n,l;s.token="",s.token_secret="",!P||(n=s._base_url+"/",s._version&&(n+=s._version+"/"),l=s._sign(n+="oauth/request_token.json",{oauth_consumer_key:s.consumer_key,_callback:"var json="}),this._load(n,{data:{oauth_consumer_key:s.consumer_key,oauth_signature:l,_callback:"var json="},async:!1},function(){s.token=s.resp.data.token,s.token_secret=s.resp.data.token_secret,e()}))},this.setToken=function(e,n){e&&(s.token=e),n&&(s._token_secret=n)},this.constructResult=function(e,n,l,d){s._checker(function(){return typeof s.resp<"u"&&null!==s.resp},function(){var f=[],p={ConsumerKey:s.consumer_key,ConsumerSecret:s.consumer_secret,AccessToken:s.token,TokenSecret:s.token_secret};if("getConnector"===n||"searchObject"===n)if(s.resp.data){var r=s.resp.count,u=s.resp.currentPage,y=s.resp.pageCount;s.resp.data.forEach(function(V){f.push(new L(s,V,e,p))});var R=new Q(f,y,r,u);typeof l<"u"&&l(R,d)}else typeof l<"u"&&l([],d);else R=new L(s,s.resp,e,p),typeof l<"u"&&l(R,d)})}}}function L(x,P,a,t){for(var h in P)this[h]=P[h];var c=this;this.object_name=a,this.token=t.AccessToken,this.token_secret=t.TokenSecret,this.consumer_key=t.ConsumerKey,this.consumer_secret=t.ConsumerSecret,this.getConnector=function(s,e,n,l,d){var f="getConnector";s=s.toLowerCase(),e||(e={}),x._request(this.object_name,c.id,s,e,f,n,l,function(){s="biographies"===s?"biography":s.substr(0,s.length-1),x.constructResult(s,f,d,c)})}}function Q(x,P,a,t){this._position=0,this._pageCount=P,this._count=a,this._currentPage=t,this.data=x,this.size=function(){return this._count},this.hasNextPage=function(){return this._currentPage<this._pageCount},this.hasPrevPage=function(){return this._currentPage>1},this.rewind=function(){this._position=0},this.current=function(){return this.data[this._position]?this.data[this._position]:null},this.key=function(){return this._position},this.next=function(){return++this._position,this.current()},this.prev=function(){return--this._position,this.current()},this.valid=function(){return!!this.data},this.hasNext=function(){return!!this.data[this._position+1]},this.hasPrev=function(){return!!this.data[this._position-1]}}var o=k(529);const H="95393125dd0a690b2f3d768b276dece0e556c419",I="45b956d08a34833bd75ec770dd3f2332f986ac98";let G=(()=>{class x{constructor(a){this.http=a,this.token="",this.token_secret="",this.api=new D(H,I,this.token,this.token_secret,""),console.log("Test api",this.api),this.api.getToken(t=>{this.api.search("artist",{name:"Bones of Minerva"},h=>{console.log("searchResult",h),h.data[0].getConnector("albums",{link:"Main",format:"Album",type:"Original"},null,100,function(s,e){console.log("Albums story",s),s.data.forEach(n=>{this.api.get("Album",n.id,null,l=>{console.log(l.data),l.getConnector("spotify",{},null,100,d=>{console.log(n.title,d)})})})})})})}getToken(){let a,t;this.token="",this.token_secret="",a="http://api.music-story.com//",a+="1.0/",t=this.sign(a,{oauth_consumer_key:H}),a+="oauth/request_token.json?oauth_consumer_key=95393125dd0a690b2f3d768b276dece0e556c419&oauth_signature_method=HMAC-SHA1&oauth_timestamp=1661768436&oauth_nonce=yRPX3viRkpl&oauth_version=1.0&oauth_signature=".concat(t),console.log("Music sotory token url:",a),this.http.get(a).subscribe(h=>{console.log("Music story:",h)})}sign(a,t){let n,l,d,f,p,h="",c="",s="",e="";if(a){for(n in t||(t={}),l=new Array,t)l.push(n);for(l.sort(),d=0;d<l.length;d++)n=this.rawurlencode_rfc3986(l[d]),f=this.rawurlencode_rfc3986(t[l[d]]),h&&(h+="&"),h+=n+"="+f;return c="GET&"+this.rawurlencode_rfc3986(a.toLowerCase())+"&"+this.rawurlencode_rfc3986(h),s=this.rawurlencode_rfc3986(I)+"&"+this.rawurlencode_rfc3986(this.token_secret),p=S()(c,s),e=N().stringify(p),e}}rawurlencode_rfc3986(a){return encodeURIComponent(a).replace("+"," ").replace("%7E","~")}}return x.\u0275fac=function(a){return new(a||x)(T.LFG(o.eN))},x.\u0275prov=T.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})();var $=k(1188);let Z=(()=>{class x{constructor(a,t,h){this.spotifyService=a,this.musicStoryService=t,this.storageService=h,this.artists=[],this.albums=[],this.tracks=[],this.loaded=!1,this.building=!1}getTrack(a){return this.tracks.find(t=>t.id===a)}loadLibrary(a){var t=this;return(0,C.Z)(function*(){if(!a&&t.loaded)return;let h=!!a;const c=yield t.spotifyService.getUserProfile(),s=c.id;console.log(c);const e=yield t.storageService.get(s+"_artists"),n=yield t.storageService.get(s+"_albums"),l=yield t.storageService.get(s+"_tracks");!h&&e&&e.length>0?(t.artists=e.map(d=>g.l.parse(d)),console.log(t.artists)):h=!0,!h&&n&&n.length>0?(t.albums=n.map(d=>B.d.parse(d)),console.log(t.albums)):h=!0,!h&&l&&l.length>0?(t.tracks=l.map(d=>U.t.parse(d)),console.log(t.tracks)):h=!0,h&&(yield t.buildLibrary(s)),t.loaded=!0})()}buildLibrary(a){var t=this;return(0,C.Z)(function*(){t.building=!0,t.artists=[],t.albums=[],t.tracks=[],t.cargando=new i;let h="Todo ok";try{let c=!0,s=null;for(;c;){const e=yield t.spotifyService.getFollowedArtists(s);c=!!e.artists.cursors.after&&e.artists.cursors.after.length>0,c&&(s=e.artists.cursors.after),e.artists.items.forEach((n,l,d)=>{let f=new g.l;f.externalUrl=n.external_urls.spotify,f.genres=n.genres,f.href=n.href,f.id=n.id,f.uri=n.uri,f.images=n.images.map(p=>{let r=new v.Q;return r.height=p.height,r.width=p.width,r.url=p.url,r}).sort((p,r)=>r.width-p.width),f.name=n.name,t.artists.push(f)})}t.artists=t.artists.sort((e,n)=>e.name>n.name?1:-1),console.log(t.artists);for(const e of t.artists){c=!0;let n=0;for(;c;){const l=yield t.spotifyService.getArtistsAlbums(e.id,n);c=!!l.next,c&&(n+=5);let d=l.items.map((f,p,r)=>{let u=new B.d;return u.id=f.id,u.name=f.name,u.releaseDate=new Date(f.release_date),u.artistId=e.id,u.artistName=e.name,u.externalUrl=f.external_urls.spotify,u.href=f.href,u.uri=f.uri,u.images=f.images.map(y=>{let _=new v.Q;return _.height=y.height,_.width=y.width,_.url=y.url,_}).sort((y,_)=>_.width-y.width),u}).sort((f,p)=>f.releaseDate.getTime()-p.releaseDate.getTime());t.albums=t.albums.concat(d)}}console.log(t.albums),t.albums=t.albums.sort((e,n)=>e.artistName!==n.artistName?e.artistName<n.artistName?-1:1:e.releaseDate.getTime()-n.releaseDate.getTime());for(const e of t.albums){console.log(e),t.cargando.album=e.name,t.cargando.artist=e.artistName,c=!0;let n=0;if(!t.tracks.find(l=>l.albumId===e.id))for(;c;){const l=yield t.spotifyService.getAlbumsTracks(e.id,n);c=!!l.next,c&&(n+=50);let d=l.items.map(f=>{let p=new U.t;return p.id=f.id,p.name=f.name,p.trackNumber=f.track_number,p.discNumber=f.disc_number,p.albumId=e.id,p.albumName=e.name,p.artistId=e.artistId,p.artistName=e.artistName,p.albumReleaseDate=e.releaseDate,!!e.images&&e.images.length>0&&!!e.images[0].url&&(p.image=e.images[0].url),p.externalURL=f.external_urls.spotify,p.href=f.href,p.uri=f.uri,p}).sort((f,p)=>{let r=f.discNumber-p.discNumber;return 0!=r?r:f.trackNumber-p.trackNumber});t.tracks=t.tracks.concat(d)}}t.tracks=t.tracks.sort((e,n)=>e.artistName!==n.artistName?e.artistName<n.artistName?-1:1:e.albumReleaseDate.getTime()!==n.albumReleaseDate.getTime()?e.albumReleaseDate.getTime()-n.albumReleaseDate.getTime():n.trackNumber-e.trackNumber)}catch(c){console.error(c),h="Error: "+c}finally{t.building=!1,t.storageService.set(a+"_artists",t.artists),t.storageService.set(a+"_albums",t.albums),t.storageService.set(a+"_tracks",t.tracks),alert(h)}})()}getAlbum(a){return this.albums.find(t=>t.id===a)}getArtist(a){return this.artists.find(t=>t.id===a)}getAlbumsByArtist(a){return this.albums.filter(t=>t.artistId===a).sort((t,h)=>t.releaseDate.getTime()-h.releaseDate.getTime())}getTracksByAlbum(a){return this.tracks.filter(t=>t.albumId===a).sort((t,h)=>t.discNumber!=h.discNumber?t.discNumber-h.discNumber:t.trackNumber-h.trackNumber)}nextTrack(a){const t=this.tracks[a],h=this.getTracksByAlbum(t.albumId),c=h.indexOf(t);if(c!=h.length-1)return h[c+1];const s=this.getAlbum(t.albumId),e=this.albums.indexOf(s);return this.getTracksByAlbum(this.nextAlbum(e).id)[0]}nextAlbum(a){const t=this.albums[a],h=this.getAlbumsByArtist(t.artistId),c=h.indexOf(t);if(c!=h.length-1)return h[c+1];const s=this.getArtist(t.artistId),e=this.artists.indexOf(s);return this.getAlbumsByArtist(this.nextArtist(e).id)[0]}nextArtist(a){return this.artists[a==this.artists.length-1?0:a+1]}updateExcluded(a){let t=this.albums.indexOf(a);this.albums[t].excluded=a.excluded,console.log("Update Excluded:",this.albums[t]),this.spotifyService.getUserProfile().then(h=>{this.storageService.set(h.id+"_albums",this.albums)})}getQueueRandomTracks(){let a=[],t=[];for(let h=0;h<500;h++){let c=this.tracks.filter(e=>!t.find(n=>n===e.artistId)&&!a.find(n=>n===e.id)),s=c[Math.floor(Math.random()*c.length)];a.push(s.id),t.unshift(s.artistId),t.length>10&&t.pop()}return a}getQueueRandomAlbums(){let a=this.albums.sort((h,c)=>.5-Math.random()).slice(0,10),t=[];for(const h of a)t=t.concat(this.tracks.filter(c=>c.albumId===h.id).sort((c,s)=>c.discNumber==s.discNumber?c.trackNumber-s.trackNumber:c.discNumber-s.discNumber).map(c=>c.uri));return t}}return x.\u0275fac=function(a){return new(a||x)(T.LFG(E.s),T.LFG(G),T.LFG($.V))},x.\u0275prov=T.Yz7({token:x,factory:x.\u0275fac,providedIn:"root"}),x})()},7585:function(F,M,k){var C;F.exports=(C=C||function(B,g){var i;if(typeof window<"u"&&window.crypto&&(i=window.crypto),typeof self<"u"&&self.crypto&&(i=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(i=globalThis.crypto),!i&&typeof window<"u"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof global<"u"&&global.crypto&&(i=global.crypto),!i)try{i=k(2480)}catch{}var v=function(){if(i){if("function"==typeof i.getRandomValues)try{return i.getRandomValues(new Uint32Array(1))[0]}catch{}if("function"==typeof i.randomBytes)try{return i.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},U=Object.create||function(){function o(){}return function(m){var H;return o.prototype=m,H=new o,o.prototype=null,H}}(),T={},E=T.lib={},A=E.Base={extend:function(o){var m=U(this);return o&&m.mixIn(o),(!m.hasOwnProperty("init")||this.init===m.init)&&(m.init=function(){m.$super.init.apply(this,arguments)}),m.init.prototype=m,m.$super=this,m},create:function(){var o=this.extend();return o.init.apply(o,arguments),o},init:function(){},mixIn:function(o){for(var m in o)o.hasOwnProperty(m)&&(this[m]=o[m]);o.hasOwnProperty("toString")&&(this.toString=o.toString)},clone:function(){return this.init.prototype.extend(this)}},S=E.WordArray=A.extend({init:function(o,m){o=this.words=o||[],this.sigBytes=null!=m?m:4*o.length},toString:function(o){return(o||N).stringify(this)},concat:function(o){var m=this.words,H=o.words,I=this.sigBytes,W=o.sigBytes;if(this.clamp(),I%4)for(var K=0;K<W;K++)m[I+K>>>2]|=(H[K>>>2]>>>24-K%4*8&255)<<24-(I+K)%4*8;else for(var G=0;G<W;G+=4)m[I+G>>>2]=H[G>>>2];return this.sigBytes+=W,this},clamp:function(){var o=this.words,m=this.sigBytes;o[m>>>2]&=4294967295<<32-m%4*8,o.length=B.ceil(m/4)},clone:function(){var o=A.clone.call(this);return o.words=this.words.slice(0),o},random:function(o){for(var m=[],H=0;H<o;H+=4)m.push(v());return new S.init(m,o)}}),b=T.enc={},N=b.Hex={stringify:function(o){for(var m=o.words,H=o.sigBytes,I=[],W=0;W<H;W++){var K=m[W>>>2]>>>24-W%4*8&255;I.push((K>>>4).toString(16)),I.push((15&K).toString(16))}return I.join("")},parse:function(o){for(var m=o.length,H=[],I=0;I<m;I+=2)H[I>>>3]|=parseInt(o.substr(I,2),16)<<24-I%8*4;return new S.init(H,m/2)}},w=b.Latin1={stringify:function(o){for(var m=o.words,H=o.sigBytes,I=[],W=0;W<H;W++)I.push(String.fromCharCode(m[W>>>2]>>>24-W%4*8&255));return I.join("")},parse:function(o){for(var m=o.length,H=[],I=0;I<m;I++)H[I>>>2]|=(255&o.charCodeAt(I))<<24-I%4*8;return new S.init(H,m)}},D=b.Utf8={stringify:function(o){try{return decodeURIComponent(escape(w.stringify(o)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(o){return w.parse(unescape(encodeURIComponent(o)))}},L=E.BufferedBlockAlgorithm=A.extend({reset:function(){this._data=new S.init,this._nDataBytes=0},_append:function(o){"string"==typeof o&&(o=D.parse(o)),this._data.concat(o),this._nDataBytes+=o.sigBytes},_process:function(o){var m,H=this._data,I=H.words,W=H.sigBytes,K=this.blockSize,G=W/(4*K),$=(G=o?B.ceil(G):B.max((0|G)-this._minBufferSize,0))*K,Z=B.min(4*$,W);if($){for(var x=0;x<$;x+=K)this._doProcessBlock(I,x);m=I.splice(0,$),H.sigBytes-=Z}return new S.init(m,Z)},clone:function(){var o=A.clone.call(this);return o._data=this._data.clone(),o},_minBufferSize:0}),z=(E.Hasher=L.extend({cfg:A.extend(),init:function(o){this.cfg=this.cfg.extend(o),this.reset()},reset:function(){L.reset.call(this),this._doReset()},update:function(o){return this._append(o),this._process(),this},finalize:function(o){return o&&this._append(o),this._doFinalize()},blockSize:16,_createHelper:function(o){return function(m,H){return new o.init(H).finalize(m)}},_createHmacHelper:function(o){return function(m,H){return new z.HMAC.init(o,H).finalize(m)}}}),T.algo={});return T}(Math),C)},8319:function(F,M,k){var C,i;F.exports=(C=k(7585),i=C.lib.WordArray,C.enc.Base64={stringify:function(E){var A=E.words,S=E.sigBytes,b=this._map;E.clamp();for(var N=[],w=0;w<S;w+=3)for(var z=(A[w>>>2]>>>24-w%4*8&255)<<16|(A[w+1>>>2]>>>24-(w+1)%4*8&255)<<8|A[w+2>>>2]>>>24-(w+2)%4*8&255,o=0;o<4&&w+.75*o<S;o++)N.push(b.charAt(z>>>6*(3-o)&63));var m=b.charAt(64);if(m)for(;N.length%4;)N.push(m);return N.join("")},parse:function(E){var A=E.length,S=this._map,b=this._reverseMap;if(!b){b=this._reverseMap=[];for(var N=0;N<S.length;N++)b[S.charCodeAt(N)]=N}var w=S.charAt(64);if(w){var D=E.indexOf(w);-1!==D&&(A=D)}return function T(E,A,S){for(var b=[],N=0,w=0;w<A;w++)if(w%4){var D=S[E.charCodeAt(w-1)]<<w%4*2,L=S[E.charCodeAt(w)]>>>6-w%4*2;b[N>>>2]|=(D|L)<<24-N%4*8,N++}return i.create(b,N)}(E,A,b)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},C.enc.Base64)},8799:function(F,M,k){var C;F.exports=(C=k(7585),k(5162),k(3764),C.HmacSHA1)},3764:function(F,M,k){var C,U;F.exports=(C=k(7585),U=C.enc.Utf8,void(C.algo.HMAC=C.lib.Base.extend({init:function(A,S){A=this._hasher=new A.init,"string"==typeof S&&(S=U.parse(S));var b=A.blockSize,N=4*b;S.sigBytes>N&&(S=A.finalize(S)),S.clamp();for(var w=this._oKey=S.clone(),D=this._iKey=S.clone(),L=w.words,Q=D.words,z=0;z<b;z++)L[z]^=1549556828,Q[z]^=909522486;w.sigBytes=D.sigBytes=N,this.reset()},reset:function(){var A=this._hasher;A.reset(),A.update(this._iKey)},update:function(A){return this._hasher.update(A),this},finalize:function(A){var S=this._hasher,b=S.finalize(A);return S.reset(),S.finalize(this._oKey.clone().concat(b))}})))},5162:function(F,M,k){var B,g,i,v,T,E,C;F.exports=(C=k(7585),i=(g=(B=C).lib).WordArray,T=[],E=B.algo.SHA1=(v=g.Hasher).extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(A,S){for(var b=this._hash.words,N=b[0],w=b[1],D=b[2],L=b[3],Q=b[4],z=0;z<80;z++){if(z<16)T[z]=0|A[S+z];else{var o=T[z-3]^T[z-8]^T[z-14]^T[z-16];T[z]=o<<1|o>>>31}var m=(N<<5|N>>>27)+Q+T[z];m+=z<20?1518500249+(w&D|~w&L):z<40?1859775393+(w^D^L):z<60?(w&D|w&L|D&L)-1894007588:(w^D^L)-899497514,Q=L,L=D,D=w<<30|w>>>2,w=N,N=m}b[0]=b[0]+N|0,b[1]=b[1]+w|0,b[2]=b[2]+D|0,b[3]=b[3]+L|0,b[4]=b[4]+Q|0},_doFinalize:function(){var A=this._data,S=A.words,b=8*this._nDataBytes,N=8*A.sigBytes;return S[N>>>5]|=128<<24-N%32,S[14+(N+64>>>9<<4)]=Math.floor(b/4294967296),S[15+(N+64>>>9<<4)]=b,A.sigBytes=4*S.length,this._process(),this._hash},clone:function(){var A=v.clone.call(this);return A._hash=this._hash.clone(),A}}),B.SHA1=v._createHelper(E),B.HmacSHA1=v._createHmacHelper(E),C.SHA1)},2480:()=>{}}]);