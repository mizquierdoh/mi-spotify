(self.webpackChunkapp=self.webpackChunkapp||[]).push([[624],{6553:(Q,L,C)=>{"use strict";C.d(L,{d:()=>x});var k=C(8735);class x{static parse(i){if(!i)return null;let g=new x;return g.id=i.id,g.name=i.name,g.releaseDate=new Date(i.releaseDate),g.artistId=i.artistId,g.artistName=i.artistName,g.externalUrl=i.externalUrl,g.href=i.href,g.uri=i.uri,g.excluded=i.excluded,g.images=i.images.map(U=>k.Q.parse(U)).sort((U,T)=>T.width-U.width),g}static parseWebPlaybackAlbum(i){let g=new x;return i&&(g.externalUrl=i.external_urls.spotify,g.href=i.href,g.id=i.id,g.images=i.images.map(U=>k.Q.parse(U)).sort((U,T)=>T.width-U.width),g.name=i.name,g.releaseDate=new Date(i.release_date),g.uri=i.uri),g}}},7986:(Q,L,C)=>{"use strict";C.d(L,{l:()=>x});var k=C(8735);class x{static parse(i){if(!i)return null;let g=new x;return g.externalUrl=i.externalUrl,g.genres=i.genres,g.href=i.href,g.id=i.id,g.images=i.images.map(U=>k.Q.parse(U)).sort((U,T)=>T.width-U.width),g.name=i.name,g.uri=i.uri,g}static parseWebPlaybackArtist(i){if(!i)return null;let g=new x;return g.externalUrl=i.external_urls.spotify,g.genres=i.genres,g.href=i.href,g.id=i.id,i.images&&(g.images=i.images.map(U=>k.Q.parse(U)).sort((U,T)=>T.width-U.width)),g.name=i.name,g.uri=i.uri,g}}},8735:(Q,L,C)=>{"use strict";C.d(L,{Q:()=>k});class k{static parse(p){if(!p)return null;let i=new k;return i.height=p.height,i.width=p.width,i.url=p.url,i}}},4733:(Q,L,C)=>{"use strict";C.d(L,{t:()=>k});class k{static parse(p){if(!p)return null;let i=new k;return i.id=p.id,i.name=p.name,i.trackNumber=p.trackNumber,i.discNumber=p.discNumber,i.albumId=p.albumId,i.albumName=p.albumName,i.albumReleaseDate=p.albumReleaseDate,i.artistId=p.artistId,i.artistName=p.artistName,i.image=p.image,i.externalURL=p.externalURL,i.href=p.href,i.uri=p.uri,i}static parsePlayerTrack(p){let i=new k;return p&&(i.artistName=p.artists[0],i.id=p.id,i.image=p.image,i.name=p.name,i.uri=p.uri),i}static parseWebPlaybackTrack(p){let i=new k;return p&&(i.albumId=p.album.id,i.albumName=p.album.name,i.albumReleaseDate=new Date(p.album.release_date),i.artistId=p.artists[0].id,i.artistName=p.artists[0].name,i.discNumber=p.disc_number,i.externalURL=p.external_urls.spotify,i.href=p.href,i.id=p.id,i.image=p.album.images.sort((g,U)=>U.width-g.width)[0].url,i.name=p.name,i.uri=p.uri,i.trackNumber=p.track_number),i}}},624:(Q,L,C)=>{"use strict";C.d(L,{$:()=>O});var k=C(5861),x=C(6553),p=C(7986);class i{}var _,g=C(8735),U=C(4733),T=C(6738),D=C(3191),S=C(8799),b=C.n(S),w=C(8319),R=C.n(w);!function z(){var P;_=_||function(B,P){var n={},e=n.lib={},h=function(){},l=e.Base={extend:function(t){h.prototype=this;var a=new h;return t&&a.mixIn(t),a.hasOwnProperty("init")||(a.init=function(){a.$super.init.apply(this,arguments)}),a.init.prototype=a,a.$super=this,a},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var a in t)t.hasOwnProperty(a)&&(this[a]=t[a]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},r=e.WordArray=l.extend({init:function(t,a){t=this.words=t||[],this.sigBytes=null!=a?a:4*t.length},toString:function(t){return(t||f).stringify(this)},concat:function(t){var a=this.words,m=t.words,v=this.sigBytes;if(t=t.sigBytes,this.clamp(),v%4)for(var A=0;A<t;A++)a[v+A>>>2]|=(m[A>>>2]>>>24-A%4*8&255)<<24-(v+A)%4*8;else if(65535<m.length)for(A=0;A<t;A+=4)a[v+A>>>2]=m[A>>>2];else a.push.apply(a,m);return this.sigBytes+=t,this},clamp:function(){var t=this.words,a=this.sigBytes;t[a>>>2]&=4294967295<<32-a%4*8,t.length=B.ceil(a/4)},clone:function(){var t=l.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var a=[],m=0;m<t;m+=4)a.push(4294967296*B.random()|0);return new r.init(a,t)}}),o=n.enc={},f=o.Hex={stringify:function(t){var a=t.words;t=t.sigBytes;for(var m=[],v=0;v<t;v++){var A=a[v>>>2]>>>24-v%4*8&255;m.push((A>>>4).toString(16)),m.push((15&A).toString(16))}return m.join("")},parse:function(t){for(var a=t.length,m=[],v=0;v<a;v+=2)m[v>>>3]|=parseInt(t.substr(v,2),16)<<24-v%8*4;return new r.init(m,a/2)}},s=o.Latin1={stringify:function(t){var a=t.words;t=t.sigBytes;for(var m=[],v=0;v<t;v++)m.push(String.fromCharCode(a[v>>>2]>>>24-v%4*8&255));return m.join("")},parse:function(t){for(var a=t.length,m=[],v=0;v<a;v++)m[v>>>2]|=(255&t.charCodeAt(v))<<24-v%4*8;return new r.init(m,a)}},c=o.Utf8={stringify:function(t){try{return decodeURIComponent(escape(s.stringify(t)))}catch{throw Error("Malformed UTF-8 data")}},parse:function(t){return s.parse(unescape(encodeURIComponent(t)))}},y=e.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=c.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(t){var a=this._data,m=a.words,v=a.sigBytes,A=this.blockSize,F=v/(4*A);if(F=t?B.ceil(F):B.max((0|F)-this._minBufferSize,0),v=B.min(4*(t=F*A),v),t){for(var X=0;X<t;X+=A)this._doProcessBlock(m,X);X=m.splice(0,t),a.sigBytes-=v}return new r.init(X,v)},clone:function(){var t=l.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});e.Hasher=y.extend({cfg:l.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){y.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(a,m){return new t.init(m).finalize(a)}},_createHmacHelper:function(t){return function(a,m){return new N.HMAC.init(t,m).finalize(a)}}});var N=n.algo={};return n}(Math),P=_.enc.Utf8,_.algo.HMAC=_.lib.Base.extend({init:function(n,e){n=this._hasher=new n.init,"string"==typeof e&&(e=P.parse(e));var h=n.blockSize,l=4*h;e.sigBytes>l&&(e=n.finalize(e)),e.clamp();for(var r=this._oKey=e.clone(),o=this._iKey=e.clone(),f=r.words,s=o.words,c=0;c<h;c++)f[c]^=1549556828,s[c]^=909522486;r.sigBytes=o.sigBytes=l,this.reset()},reset:function(){var n=this._hasher;n.reset(),n.update(this._iKey)},update:function(n){return this._hasher.update(n),this},finalize:function(n){var e=this._hasher;return n=e.finalize(n),e.reset(),e.finalize(this._oKey.clone().concat(n))}}),function(){var P=_.lib.WordArray;_.enc.Base64={stringify:function(n){var e=n.words,h=n.sigBytes,l=this._map;n.clamp(),n=[];for(var r=0;r<h;r+=3)for(var o=(e[r>>>2]>>>24-r%4*8&255)<<16|(e[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|e[r+2>>>2]>>>24-(r+2)%4*8&255,f=0;4>f&&r+.75*f<h;f++)n.push(l.charAt(o>>>6*(3-f)&63));if(e=l.charAt(64))for(;n.length%4;)n.push(e);return n.join("")},parse:function(n){var e=n.length,h=this._map;(l=h.charAt(64))&&-1!=(l=n.indexOf(l))&&(e=l);for(var l=[],r=0,o=0;o<e;o++)if(o%4){var f=h.indexOf(n.charAt(o-1))<<o%4*2,s=h.indexOf(n.charAt(o))>>>6-o%4*2;l[r>>>2]|=(f|s)<<24-r%4*8,r++}return P.create(l,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(){var B=_,P=(h=B.lib).WordArray,n=h.Hasher,e=[],h=B.algo.SHA1=n.extend({_doReset:function(){this._hash=new P.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(l,r){for(var o=this._hash.words,f=o[0],s=o[1],c=o[2],y=o[3],N=o[4],t=0;80>t;t++){if(16>t)e[t]=0|l[r+t];else{var a=e[t-3]^e[t-8]^e[t-14]^e[t-16];e[t]=a<<1|a>>>31}a=(f<<5|f>>>27)+N+e[t],a=20>t?a+(1518500249+(s&c|~s&y)):40>t?a+(1859775393+(s^c^y)):60>t?a+((s&c|s&y|c&y)-1894007588):a+((s^c^y)-899497514),N=y,y=c,c=s<<30|s>>>2,s=f,f=a}o[0]=o[0]+f|0,o[1]=o[1]+s|0,o[2]=o[2]+c|0,o[3]=o[3]+y|0,o[4]=o[4]+N|0},_doFinalize:function(){var l=this._data,r=l.words,o=8*this._nDataBytes,f=8*l.sigBytes;return r[f>>>5]|=128<<24-f%32,r[14+(f+64>>>9<<4)]=Math.floor(o/4294967296),r[15+(f+64>>>9<<4)]=o,l.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var l=n.clone.call(this);return l._hash=this._hash.clone(),l}});B.SHA1=n._createHelper(h),B.HmacSHA1=n._createHmacHelper(h)}()}();class E{constructor(P,n,e,h,l){var r=this;this.consumer_key=P,this.consumer_secret=n,this.token=e,this.token_secret=h,this._version=l,this._base_url="http://api.music-story.com",this.resp=null,this._checker=function(o,f){var s=setInterval(function(){o()&&(clearInterval(s),f())},10)},this._rawurlencode_rfc3986=function(o){return encodeURIComponent(o).replace("+"," ").replace("%7E","~")},this._load=function(o,f,s){var c=document.createElement("script"),y=document.getElementsByTagName("head")[0];c.type="text/javascript";var N="";for(const t in f.data)N?N+="&":N="?",N+=t+"="+encodeURIComponent(f.data[t]);c.src=o+=N,c.onload=function(){r.resp=json,y.removeChild(c),typeof s<"u"&&s()},y.appendChild(c)},this.get=function(o,f,s,c){if(typeof s>"u"&&(s=null),f){o=o.toLowerCase();var y="getObject";r._request(o,f,null,null,y,null,null,function(){r.constructResult(o,y,c)})}},this.search=function(o,f,s,c,y){o=o.toLowerCase();var N="searchObject";!f||r._request(o,null,null,f,N,c,y,function(){r.constructResult(o,N,s)})},this._sign=function(o,f){var t,a,m,s="",c="",y="";if(o){for(t in f||(f={}),a=new Array,f)a.push(t);for(a.sort(),m=0;m<a.length;m++)s&&(s+="&"),s+=(t=r._rawurlencode_rfc3986(a[m]))+"="+r._rawurlencode_rfc3986(f[a[m]]);return c="GET&"+r._rawurlencode_rfc3986(o.toLowerCase())+"&"+r._rawurlencode_rfc3986(s),y=r._rawurlencode_rfc3986(r.consumer_secret)+"&"+r._rawurlencode_rfc3986(r.token_secret),_.HmacSHA1(c,y).toString(_.enc.Base64)}},this._request=function(o,f,s,c,y,N,t,a){!o&&"getConnector"!==y||"searchObject"===y&&!c||!y||(r.token&&r.token_secret?r._requestsuite(o,f,s,c,y,N,t,a):r.getToken(function(){r._requestsuite(o,f,s,c,y,N,t,a)}))},this._requestsuite=function(o,f,s,c,y,N,t,a){var m,v,A,F;for(A in m=r._base_url+"/"+o,f&&(m+="/"+f),"searchObject"===y&&(m+="/search"),"getConnector"===y&&(m=m+"/"+s),m+=".json",v={oauth_token:r.token,_callback:"var json="},N&&(c.page||(c.page=N)),t&&(c.pageCount||(c.pageCount=t)),c)v[A]=c[A];for(A in F=r._sign(m,v),m+="?oauth_signature="+encodeURIComponent(F),v)m+="&"+encodeURIComponent(A)+"="+encodeURIComponent(v[A]);r._load(m,{},a)},this.getToken=function(o){var f,s;r.token="",r.token_secret="",!P||(f=r._base_url+"/",r._version&&(f+=r._version+"/"),s=r._sign(f+="oauth/request_token.json",{oauth_consumer_key:r.consumer_key,_callback:"var json="}),this._load(f,{data:{oauth_consumer_key:r.consumer_key,oauth_signature:s,_callback:"var json="},async:!1},function(){r.token=r.resp.data.token,r.token_secret=r.resp.data.token_secret,o()}))},this.setToken=function(o,f){o&&(r.token=o),f&&(r._token_secret=f)},this.constructResult=function(o,f,s,c){r._checker(function(){return typeof r.resp<"u"&&null!==r.resp},function(){var y=[],N={ConsumerKey:r.consumer_key,ConsumerSecret:r.consumer_secret,AccessToken:r.token,TokenSecret:r.token_secret};if("getConnector"===f||"searchObject"===f)if(r.resp.data){var t=r.resp.count,a=r.resp.currentPage,m=r.resp.pageCount;r.resp.data.forEach(function(F){y.push(new M(r,F,o,N))});var A=new G(y,m,t,a);typeof s<"u"&&s(A,c)}else typeof s<"u"&&s([],c);else A=new M(r,r.resp,o,N),typeof s<"u"&&s(A,c)})}}}function M(B,P,n,e){for(var h in P)this[h]=P[h];var l=this;this.object_name=n,this.token=e.AccessToken,this.token_secret=e.TokenSecret,this.consumer_key=e.ConsumerKey,this.consumer_secret=e.ConsumerSecret,this.getConnector=function(r,o,f,s,c){var y="getConnector";r=r.toLowerCase(),o||(o={}),B._request(this.object_name,l.id,r,o,y,f,s,function(){r="biographies"===r?"biography":r.substr(0,r.length-1),B.constructResult(r,y,c,l)})}}function G(B,P,n,e){this._position=0,this._pageCount=P,this._count=n,this._currentPage=e,this.data=B,this.size=function(){return this._count},this.hasNextPage=function(){return this._currentPage<this._pageCount},this.hasPrevPage=function(){return this._currentPage>1},this.rewind=function(){this._position=0},this.current=function(){return this.data[this._position]?this.data[this._position]:null},this.key=function(){return this._position},this.next=function(){return++this._position,this.current()},this.prev=function(){return--this._position,this.current()},this.valid=function(){return!!this.data},this.hasNext=function(){return!!this.data[this._position+1]},this.hasPrev=function(){return!!this.data[this._position-1]}}var u=C(529);const H="95393125dd0a690b2f3d768b276dece0e556c419",I="45b956d08a34833bd75ec770dd3f2332f986ac98";let V=(()=>{class B{constructor(n){this.http=n,this.token="",this.token_secret="",this.api=new E(H,I,this.token,this.token_secret,""),console.log("Test api",this.api),this.api.getToken(e=>{this.api.search("artist",{name:"Bones of Minerva"},h=>{console.log("searchResult",h),h.data[0].getConnector("albums",{link:"Main",format:"Album",type:"Original"},null,100,function(r,o){console.log("Albums story",r),r.data.forEach(f=>{this.api.get("Album",f.id,null,s=>{console.log(s.data),s.getConnector("spotify",{},null,100,c=>{console.log(f.title,c)})})})})})})}getToken(){let n,e;this.token="",this.token_secret="",n="http://api.music-story.com//",n+="1.0/",e=this.sign(n,{oauth_consumer_key:H}),n+="oauth/request_token.json?oauth_consumer_key=95393125dd0a690b2f3d768b276dece0e556c419&oauth_signature_method=HMAC-SHA1&oauth_timestamp=1661768436&oauth_nonce=yRPX3viRkpl&oauth_version=1.0&oauth_signature=".concat(e),console.log("Music sotory token url:",n),this.http.get(n).subscribe(h=>{console.log("Music story:",h)})}sign(n,e){let f,s,c,y,N,h="",l="",r="",o="";if(n){for(f in e||(e={}),s=new Array,e)s.push(f);for(s.sort(),c=0;c<s.length;c++)f=this.rawurlencode_rfc3986(s[c]),y=this.rawurlencode_rfc3986(e[s[c]]),h&&(h+="&"),h+=f+"="+y;return l="GET&"+this.rawurlencode_rfc3986(n.toLowerCase())+"&"+this.rawurlencode_rfc3986(h),r=this.rawurlencode_rfc3986(I)+"&"+this.rawurlencode_rfc3986(this.token_secret),N=b()(l,r),o=R().stringify(N),o}}rawurlencode_rfc3986(n){return encodeURIComponent(n).replace("+"," ").replace("%7E","~")}}return B.\u0275fac=function(n){return new(n||B)(T.LFG(u.eN))},B.\u0275prov=T.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"}),B})();var $=C(1188);const Z=["1dmBXO2zmCbsf8qAicqbs0","75XBzgU4127dLsTz7r7Cn2","6jZEjwGAaF0MJHQ73nymWY","0VMADiePYCgnZR5eH8iWHl","3geEhXhmMtb7iidsENVBKf"];let O=(()=>{class B{constructor(n,e,h){this.spotifyService=n,this.musicStoryService=e,this.storageService=h,this.artists=[],this.albums=[],this.tracks=[],this.loaded=!1,this.building=!1}getTrack(n){return this.tracks.find(e=>e.id===n)}loadLibrary(n){var e=this;return(0,k.Z)(function*(){if(!n&&e.loaded)return;let h=!!n;const l=yield e.spotifyService.getUserProfile(),r=l.id;console.log(l);const o=yield e.storageService.get(r+"_artists"),f=yield e.storageService.get(r+"_albums"),s=yield e.storageService.get(r+"_tracks");!h&&o&&o.length>0?(e.artists=o.map(c=>p.l.parse(c)),console.log(e.artists)):h=!0,!h&&f&&f.length>0?(e.albums=f.map(c=>x.d.parse(c)),console.log(e.albums)):h=!0,!h&&s&&s.length>0?(e.tracks=s.map(c=>U.t.parse(c)),console.log(e.tracks)):h=!0,h&&(yield e.buildLibrary(r)),e.loaded=!0})()}buildLibrary(n){var e=this;return(0,k.Z)(function*(){e.building=!0,e.artists=[],e.albums=[],e.cargando=new i;let h="Todo ok";try{let l=!0,r=null;for(;l;){const s=yield e.spotifyService.getFollowedArtists(r);l=!!s.artists.cursors.after&&s.artists.cursors.after.length>0,l&&(r=s.artists.cursors.after),s.artists.items.forEach((c,y,N)=>{let t=new p.l;t.externalUrl=c.external_urls.spotify,t.genres=c.genres,t.href=c.href,t.id=c.id,t.uri=c.uri,t.images=c.images.map(a=>{let m=new g.Q;return m.height=a.height,m.width=a.width,m.url=a.url,m}).sort((a,m)=>m.width-a.width),t.name=c.name,e.artists.push(t)})}e.artists=e.artists.sort((s,c)=>s.name>c.name?1:-1),console.log(e.artists);for(const s of e.artists){l=!0;let c=0;for(;l;){const y=yield e.spotifyService.getArtistsAlbums(s.id,c);l=!!y.next,l&&(c+=5);let N=y.items.map((t,a,m)=>{let v=new x.d;return v.id=t.id,v.name=t.name,v.releaseDate=new Date(t.release_date),v.artistId=s.id,v.artistName=s.name,v.externalUrl=t.external_urls.spotify,v.href=t.href,v.uri=t.uri,v.images=t.images.map(A=>{let F=new g.Q;return F.height=A.height,F.width=A.width,F.url=A.url,F}).sort((A,F)=>F.width-A.width),v}).sort((t,a)=>t.releaseDate.getTime()-a.releaseDate.getTime());e.albums=e.albums.concat(N)}}console.log(e.albums),e.albums=e.albums.sort((s,c)=>s.artistName!==c.artistName?s.artistName<c.artistName?-1:1:s.releaseDate.getTime()-c.releaseDate.getTime());const o=(yield e.storageService.get(n+"_albums")).map(s=>s.id),f=e.albums.filter(s=>!o.includes(s.id));for(const s of f){console.log(s),e.cargando.album=s.name,e.cargando.artist=s.artistName,l=!0;let c=0;if(!e.tracks.find(y=>y.albumId===s.id))for(;l;){const y=yield e.spotifyService.getAlbumsTracks(s.id,c);l=!!y.next,l&&(c+=50);let N=y.items.map(t=>{let a=new U.t;return a.id=t.id,a.name=t.name,a.trackNumber=t.track_number,a.discNumber=t.disc_number,a.albumId=s.id,a.albumName=s.name,a.artistId=s.artistId,a.artistName=s.artistName,a.albumReleaseDate=s.releaseDate,!!s.images&&s.images.length>0&&!!s.images[0].url&&(a.image=s.images[0].url),a.externalURL=t.external_urls.spotify,a.href=t.href,a.uri=t.uri,a}).sort((t,a)=>{let m=t.discNumber-a.discNumber;return 0!=m?m:t.trackNumber-a.trackNumber});e.tracks=e.tracks.concat(N)}}e.tracks=e.tracks.sort((s,c)=>s.artistName!==c.artistName?s.artistName<c.artistName?-1:1:s.albumReleaseDate.getTime()!==c.albumReleaseDate.getTime()?s.albumReleaseDate.getTime()-c.albumReleaseDate.getTime():c.trackNumber-s.trackNumber)}catch(l){console.error(l),h="Error: "+l}finally{e.building=!1,e.storageService.set(n+"_artists",e.artists),e.storageService.set(n+"_albums",e.albums),e.storageService.set(n+"_tracks",e.tracks),alert(h)}})()}getAlbum(n){return this.albums.find(e=>e.id===n)}getArtist(n){return this.artists.find(e=>e.id===n)}getAlbumsByArtist(n){return this.albums.filter(e=>e.artistId===n).sort((e,h)=>e.releaseDate.getTime()-h.releaseDate.getTime())}getTracksByAlbum(n){return this.tracks.filter(e=>e.albumId===n).sort((e,h)=>e.discNumber!=h.discNumber?e.discNumber-h.discNumber:e.trackNumber-h.trackNumber)}nextTrack(n){const e=this.tracks[n],h=this.getTracksByAlbum(e.albumId),l=h.indexOf(e);if(l!=h.length-1)return h[l+1];const r=this.getAlbum(e.albumId),o=this.albums.indexOf(r);return this.getTracksByAlbum(this.nextAlbum(o).id)[0]}nextAlbum(n){const e=this.albums[n],h=this.getAlbumsByArtist(e.artistId),l=h.indexOf(e);if(l!=h.length-1)return h[l+1];const r=this.getArtist(e.artistId),o=this.artists.indexOf(r);return this.getAlbumsByArtist(this.nextArtist(o).id)[0]}nextArtist(n){return this.artists[n==this.artists.length-1?0:n+1]}updateExcluded(n){let e=this.albums.indexOf(n);this.albums[e].excluded=n.excluded,console.log("Update Excluded:",this.albums[e]),this.spotifyService.getUserProfile().then(h=>{this.storageService.set(h.id+"_albums",this.albums)})}getQueueRandomTracks(){let n=[],e=[];for(let h=0;h<500;h++){let l=Date.now(),r=this.tracks.filter(f=>!e.find(s=>s===f.artistId)&&!n.find(s=>s===f.uri)),o=r[Math.floor(Math.random()*r.length)];n.push(o.uri),e.unshift(o.artistId),e.length>10&&e.pop(),console.log(`Pista ${h} - ${Date.now()-l} ms`)}return n}getQueueRandomAlbums(){let n=this.albums.filter(h=>!Z.includes(h.id)).sort((h,l)=>.5-Math.random()).slice(0,10),e=[];for(const h of n)e=e.concat(this.tracks.filter(l=>l.albumId===h.id).sort((l,r)=>l.discNumber==r.discNumber?l.trackNumber-r.trackNumber:l.discNumber-r.discNumber).map(l=>l.uri));return e}}return B.\u0275fac=function(n){return new(n||B)(T.LFG(D.s),T.LFG(V),T.LFG($.V))},B.\u0275prov=T.Yz7({token:B,factory:B.\u0275fac,providedIn:"root"}),B})()},7585:function(Q,L,C){var k;Q.exports=(k=k||function(x,p){var i;if(typeof window<"u"&&window.crypto&&(i=window.crypto),typeof self<"u"&&self.crypto&&(i=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(i=globalThis.crypto),!i&&typeof window<"u"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof global<"u"&&global.crypto&&(i=global.crypto),!i)try{i=C(2480)}catch{}var g=function(){if(i){if("function"==typeof i.getRandomValues)try{return i.getRandomValues(new Uint32Array(1))[0]}catch{}if("function"==typeof i.randomBytes)try{return i.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},U=Object.create||function(){function u(){}return function(d){var H;return u.prototype=d,H=new u,u.prototype=null,H}}(),T={},D=T.lib={},S=D.Base={extend:function(u){var d=U(this);return u&&d.mixIn(u),(!d.hasOwnProperty("init")||this.init===d.init)&&(d.init=function(){d.$super.init.apply(this,arguments)}),d.init.prototype=d,d.$super=this,d},create:function(){var u=this.extend();return u.init.apply(u,arguments),u},init:function(){},mixIn:function(u){for(var d in u)u.hasOwnProperty(d)&&(this[d]=u[d]);u.hasOwnProperty("toString")&&(this.toString=u.toString)},clone:function(){return this.init.prototype.extend(this)}},b=D.WordArray=S.extend({init:function(u,d){u=this.words=u||[],this.sigBytes=null!=d?d:4*u.length},toString:function(u){return(u||R).stringify(this)},concat:function(u){var d=this.words,H=u.words,I=this.sigBytes,W=u.sigBytes;if(this.clamp(),I%4)for(var K=0;K<W;K++)d[I+K>>>2]|=(H[K>>>2]>>>24-K%4*8&255)<<24-(I+K)%4*8;else for(var V=0;V<W;V+=4)d[I+V>>>2]=H[V>>>2];return this.sigBytes+=W,this},clamp:function(){var u=this.words,d=this.sigBytes;u[d>>>2]&=4294967295<<32-d%4*8,u.length=x.ceil(d/4)},clone:function(){var u=S.clone.call(this);return u.words=this.words.slice(0),u},random:function(u){for(var d=[],H=0;H<u;H+=4)d.push(g());return new b.init(d,u)}}),w=T.enc={},R=w.Hex={stringify:function(u){for(var d=u.words,H=u.sigBytes,I=[],W=0;W<H;W++){var K=d[W>>>2]>>>24-W%4*8&255;I.push((K>>>4).toString(16)),I.push((15&K).toString(16))}return I.join("")},parse:function(u){for(var d=u.length,H=[],I=0;I<d;I+=2)H[I>>>3]|=parseInt(u.substr(I,2),16)<<24-I%8*4;return new b.init(H,d/2)}},_=w.Latin1={stringify:function(u){for(var d=u.words,H=u.sigBytes,I=[],W=0;W<H;W++)I.push(String.fromCharCode(d[W>>>2]>>>24-W%4*8&255));return I.join("")},parse:function(u){for(var d=u.length,H=[],I=0;I<d;I++)H[I>>>2]|=(255&u.charCodeAt(I))<<24-I%4*8;return new b.init(H,d)}},E=w.Utf8={stringify:function(u){try{return decodeURIComponent(escape(_.stringify(u)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(u){return _.parse(unescape(encodeURIComponent(u)))}},M=D.BufferedBlockAlgorithm=S.extend({reset:function(){this._data=new b.init,this._nDataBytes=0},_append:function(u){"string"==typeof u&&(u=E.parse(u)),this._data.concat(u),this._nDataBytes+=u.sigBytes},_process:function(u){var d,H=this._data,I=H.words,W=H.sigBytes,K=this.blockSize,V=W/(4*K),$=(V=u?x.ceil(V):x.max((0|V)-this._minBufferSize,0))*K,Z=x.min(4*$,W);if($){for(var O=0;O<$;O+=K)this._doProcessBlock(I,O);d=I.splice(0,$),H.sigBytes-=Z}return new b.init(d,Z)},clone:function(){var u=S.clone.call(this);return u._data=this._data.clone(),u},_minBufferSize:0}),z=(D.Hasher=M.extend({cfg:S.extend(),init:function(u){this.cfg=this.cfg.extend(u),this.reset()},reset:function(){M.reset.call(this),this._doReset()},update:function(u){return this._append(u),this._process(),this},finalize:function(u){return u&&this._append(u),this._doFinalize()},blockSize:16,_createHelper:function(u){return function(d,H){return new u.init(H).finalize(d)}},_createHmacHelper:function(u){return function(d,H){return new z.HMAC.init(u,H).finalize(d)}}}),T.algo={});return T}(Math),k)},8319:function(Q,L,C){var k,i;Q.exports=(k=C(7585),i=k.lib.WordArray,k.enc.Base64={stringify:function(D){var S=D.words,b=D.sigBytes,w=this._map;D.clamp();for(var R=[],_=0;_<b;_+=3)for(var z=(S[_>>>2]>>>24-_%4*8&255)<<16|(S[_+1>>>2]>>>24-(_+1)%4*8&255)<<8|S[_+2>>>2]>>>24-(_+2)%4*8&255,u=0;u<4&&_+.75*u<b;u++)R.push(w.charAt(z>>>6*(3-u)&63));var d=w.charAt(64);if(d)for(;R.length%4;)R.push(d);return R.join("")},parse:function(D){var S=D.length,b=this._map,w=this._reverseMap;if(!w){w=this._reverseMap=[];for(var R=0;R<b.length;R++)w[b.charCodeAt(R)]=R}var _=b.charAt(64);if(_){var E=D.indexOf(_);-1!==E&&(S=E)}return function T(D,S,b){for(var w=[],R=0,_=0;_<S;_++)if(_%4){var E=b[D.charCodeAt(_-1)]<<_%4*2,M=b[D.charCodeAt(_)]>>>6-_%4*2;w[R>>>2]|=(E|M)<<24-R%4*8,R++}return i.create(w,R)}(D,S,w)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},k.enc.Base64)},8799:function(Q,L,C){var k;Q.exports=(k=C(7585),C(5162),C(3764),k.HmacSHA1)},3764:function(Q,L,C){var k,U;Q.exports=(k=C(7585),U=k.enc.Utf8,void(k.algo.HMAC=k.lib.Base.extend({init:function(S,b){S=this._hasher=new S.init,"string"==typeof b&&(b=U.parse(b));var w=S.blockSize,R=4*w;b.sigBytes>R&&(b=S.finalize(b)),b.clamp();for(var _=this._oKey=b.clone(),E=this._iKey=b.clone(),M=_.words,G=E.words,z=0;z<w;z++)M[z]^=1549556828,G[z]^=909522486;_.sigBytes=E.sigBytes=R,this.reset()},reset:function(){var S=this._hasher;S.reset(),S.update(this._iKey)},update:function(S){return this._hasher.update(S),this},finalize:function(S){var b=this._hasher,w=b.finalize(S);return b.reset(),b.finalize(this._oKey.clone().concat(w))}})))},5162:function(Q,L,C){var x,p,i,g,T,D,k;Q.exports=(k=C(7585),i=(p=(x=k).lib).WordArray,T=[],D=x.algo.SHA1=(g=p.Hasher).extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(S,b){for(var w=this._hash.words,R=w[0],_=w[1],E=w[2],M=w[3],G=w[4],z=0;z<80;z++){if(z<16)T[z]=0|S[b+z];else{var u=T[z-3]^T[z-8]^T[z-14]^T[z-16];T[z]=u<<1|u>>>31}var d=(R<<5|R>>>27)+G+T[z];d+=z<20?1518500249+(_&E|~_&M):z<40?1859775393+(_^E^M):z<60?(_&E|_&M|E&M)-1894007588:(_^E^M)-899497514,G=M,M=E,E=_<<30|_>>>2,_=R,R=d}w[0]=w[0]+R|0,w[1]=w[1]+_|0,w[2]=w[2]+E|0,w[3]=w[3]+M|0,w[4]=w[4]+G|0},_doFinalize:function(){var S=this._data,b=S.words,w=8*this._nDataBytes,R=8*S.sigBytes;return b[R>>>5]|=128<<24-R%32,b[14+(R+64>>>9<<4)]=Math.floor(w/4294967296),b[15+(R+64>>>9<<4)]=w,S.sigBytes=4*b.length,this._process(),this._hash},clone:function(){var S=g.clone.call(this);return S._hash=this._hash.clone(),S}}),x.SHA1=g._createHelper(D),x.HmacSHA1=g._createHmacHelper(D),k.SHA1)},2480:()=>{}}]);